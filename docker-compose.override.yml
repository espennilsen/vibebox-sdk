# Docker Compose Override - For dev container compatibility
# Uses environment variable for workspace path to support different machines
# Set WORKSPACE_ROOT in .env or shell (e.g., export WORKSPACE_ROOT=/Users/espen/Dev/vibebox)

version: '3.8'

services:
  backend:
    volumes:
      - ${WORKSPACE_ROOT:-.}/backend:/app
      - /app/node_modules
      - /var/run/docker.sock:/var/run/docker.sock

  frontend:
    volumes:
      - ${WORKSPACE_ROOT:-.}/frontend:/app
      - /app/node_modules

  prometheus:
    volumes:
      - ${WORKSPACE_ROOT:-.}/monitoring/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml:ro
      - ${WORKSPACE_ROOT:-.}/monitoring/prometheus/alerts.yml:/etc/prometheus/alerts.yml:ro
      - prometheus_data:/prometheus

  grafana:
    volumes:
      - ${WORKSPACE_ROOT:-.}/monitoring/grafana/provisioning/datasources:/etc/grafana/provisioning/datasources:ro
      - ${WORKSPACE_ROOT:-.}/monitoring/grafana/provisioning/dashboards:/etc/grafana/provisioning/dashboards:ro
      - ${WORKSPACE_ROOT:-.}/monitoring/grafana/dashboards:/var/lib/grafana/dashboards:ro
      - grafana_data:/var/lib/grafana

volumes:
  postgres_data:
  prometheus_data:
  grafana_data:
